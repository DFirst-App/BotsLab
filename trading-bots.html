<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Primary Meta Tags -->
  <title>Automated Trading Bots - Free Forex, Crypto & Binary Options Bots | Magic Automation Lab</title>
  <meta name="title" content="Automated Trading Bots - Free Forex, Crypto & Binary Options Bots">
  <meta name="description" content="Free automated trading bots for forex, crypto, and binary options. 10+ professional bots with smart recovery, risk management, and real-time signals. Start automated trading today.">
  <meta name="keywords" content="automated trading bots, forex trading bots, crypto trading bots, binary options bots, free trading bots, algorithmic trading, trading automation, forex robots, crypto robots, trading signals, automated forex, trading software, AI trading bots, volatility trading, digit trading">
  <meta name="author" content="Magic Automation Lab">
  <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
  <meta name="language" content="English">
  <meta name="theme-color" content="#0f1117">
  
  <!-- Canonical URL -->
  <link rel="canonical" href="https://magicbotslab.com/trading-bots.html">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://magicbotslab.com/trading-bots.html">
  <meta property="og:title" content="Automated Trading Bots - Free Forex, Crypto & Binary Options">
  <meta property="og:description" content="Free automated trading bots for forex, crypto, and binary options. 10+ professional bots with smart recovery and risk management.">
  <meta property="og:image" content="https://magicbotslab.com/og-image-trading-bots.jpg">
  <meta property="og:site_name" content="Magic Automation Lab">
  
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Automated Trading Bots - Free Forex, Crypto & Binary Options">
  <meta name="twitter:description" content="Free automated trading bots for forex, crypto, and binary options. 10+ professional bots with smart recovery.">
  <meta name="twitter:image" content="https://magicbotslab.com/og-image-trading-bots.jpg">
  
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-4WCDE6D602"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-4WCDE6D602');
  </script>
  
  <!-- Structured Data (JSON-LD) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    "name": "Automated Trading Bots",
    "description": "Collection of free automated trading bots for forex, crypto, and binary options trading",
    "url": "https://magicbotslab.com/trading-bots.html",
    "mainEntity": {
      "@type": "ItemList",
      "itemListElement": [
        {
          "@type": "SoftwareApplication",
          "name": "All Markets Differ Bot",
          "description": "Digit differ strategy bot cycling through volatility markets"
        },
        {
          "@type": "SoftwareApplication",
          "name": "Smart Volatility Bot",
          "description": "ATR-driven CALL/PUT scalping bot with volatility analysis"
        },
        {
          "@type": "SoftwareApplication",
          "name": "Magic Random Strategy Bot",
          "description": "Multi-strategy bot with random market and digit selection"
        }
      ]
    }
  }
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      color-scheme: dark;
      --bg: #0f1117;
      --panel: #171b24;
      --panel-strong: #1f2531;
      --panel-soft: rgba(23, 27, 36, 0.9);
      --accent: #00d2ff;
      --accent-2: #ff7a18;
      --text: #f5f7ff;
      --muted: #98a2bd;
      --border: rgba(255,255,255,0.08);
      --success: #24d970;
      --danger: #ff5f6d;
      --warning: #fcd34d;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: radial-gradient(circle at top right, rgba(0, 210, 255, 0.25), transparent 40%), var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .grid-bg {
      position: fixed;
      inset: 0;
      pointer-events: none;
      background-image: 
        linear-gradient(rgba(0, 210, 255, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 210, 255, 0.03) 1px, transparent 1px);
      background-size: 32px 32px;
      z-index: 0;
    }

    .page {
      position: relative;
      z-index: 1;
      width: 100%;
      max-width: 1400px;
      margin: 0 auto;
      min-height: 100vh;
      padding: 24px;
      padding-bottom: 100px;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      margin-bottom: 8px;
      position: relative;
    }

    .header-default {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .header-default h1 {
      margin: 0;
      font-size: 16px;
      font-weight: 500;
      color: var(--muted);
      letter-spacing: 0.02em;
      text-transform: uppercase;
      font-family: 'Inter', system-ui, sans-serif;
    }

    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text);
      text-decoration: none;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s ease;
      font-family: 'Inter', system-ui, sans-serif;
    }

    .back-btn .full-text {
      display: inline;
    }

    .back-btn .short-text {
      display: none;
    }

    .header-active {
      display: none;
      align-items: center;
      gap: 8px;
      flex: 1;
      min-width: 0;
    }

    .header-active button {
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      background: rgba(255, 255, 255, 0.05);
      color: var(--text);
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .header-active button:hover {
      background: rgba(0, 210, 255, 0.15);
      border-color: rgba(0, 210, 255, 0.4);
    }

    .header-active span {
      font-size: 11px;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.8);
      letter-spacing: 0.03em;
      text-transform: uppercase;
    }

    .header.show-active .header-default {
      display: none;
    }

    .header.show-active .header-active {
      display: inline-flex;
    }

    .header-mt5-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid rgba(0, 210, 255, 0.4);
      color: #00d2ff;
      font-size: 11px;
      font-weight: 600;
      text-decoration: none;
      background: rgba(0, 210, 255, 0.08);
      transition: all 0.2s ease;
      font-family: 'Inter', system-ui, sans-serif;
      margin-left: auto;
    }

    .header-mt5-btn:hover {
      background: rgba(0, 210, 255, 0.15);
      border-color: rgba(0, 210, 255, 0.6);
      transform: translateY(-1px);
    }

    .header-mt5-btn .full-text {
      display: inline;
    }

    .header-mt5-btn .short-text {
      display: none;
    }

    @media (max-width: 768px) {
      .header-mt5-btn {
        padding: 5px 8px;
        font-size: 10px;
        gap: 4px;
      }

      .header-mt5-btn .full-text {
        display: none;
      }

      .header-mt5-btn .short-text {
        display: inline;
      }
    }

    @media (max-width: 480px) {
      .header-mt5-btn {
        padding: 4px 6px;
        font-size: 9px;
        gap: 3px;
      }
    }

    .section-heading {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 16px;
      justify-content: space-between;
    }

    .section-heading.hidden {
      display: none !important;
    }

    .page:has(.header.show-active) .section-heading {
      display: none !important;
    }

    .section-heading-text {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .section-heading h2 {
      margin: 0;
      font-size: 16px;
      font-weight: 500;
      color: var(--text);
      letter-spacing: 0.02em;
      font-family: 'Inter', system-ui, sans-serif;
    }

    .section-heading p {
      margin: 0;
      color: var(--muted);
      font-size: 13px;
    }

    .deriv-balance-display {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 8px;
      background: linear-gradient(135deg, rgba(0, 210, 255, 0.12), rgba(0, 210, 255, 0.06));
      border: 1px solid rgba(0, 210, 255, 0.25);
      font-family: 'Inter', system-ui, sans-serif;
    }

    .deriv-balance-label {
      font-size: 11px;
      font-weight: 600;
      color: rgba(152, 162, 189, 0.8);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .deriv-balance-value {
      font-size: 13px;
      font-weight: 700;
      color: #00d2ff;
      letter-spacing: -0.01em;
    }

    .deriv-balance-currency {
      font-size: 11px;
      font-weight: 600;
      color: rgba(152, 162, 189, 0.7);
      margin-left: 2px;
    }

    .deriv-balance-display.disconnected {
      background: rgba(255, 255, 255, 0.04);
      border-color: rgba(255, 255, 255, 0.1);
    }

    .deriv-balance-display.disconnected .deriv-balance-value {
      color: var(--muted);
    }

    .secondary-btn-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      border-radius: 10px;
      border: 1px solid rgba(0, 210, 255, 0.4);
      color: #00d2ff;
      font-size: 13px;
      font-weight: 600;
      text-decoration: none;
      background: rgba(0, 210, 255, 0.08);
      transition: all 0.2s ease;
    }

    .secondary-btn-link:hover {
      background: rgba(0, 210, 255, 0.15);
      border-color: rgba(0, 210, 255, 0.6);
      transform: translateY(-1px);
    }

    .bots-layout {
      display: flex;
      gap: 24px;
      align-items: flex-start;
      width: 100%;
      flex-wrap: wrap;
    }

    .bots-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      flex: 1 1 600px;
    }

    .bots-list.hidden {
      display: none;
    }

    .bot-card {
      background: var(--panel);
      border-radius: 18px;
      padding: 24px;
      border: 1px solid var(--border);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .bot-card::after {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      border: 1px solid transparent;
      background: linear-gradient(120deg, rgba(0, 210, 255, 0.35), rgba(255, 122, 24, 0.2));
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 0;
    }

    .bot-card.active::after,
    .bot-card:hover::after {
      opacity: 1;
    }

    .bot-card-content {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .bot-chip {
      display: inline-flex;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(0, 210, 255, 0.12);
      border: 1px solid rgba(0, 210, 255, 0.25);
      color: #00d2ff;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    .bot-card h3 {
      margin: 0;
      font-size: 20px;
      font-weight: 700;
      color: var(--text);
      letter-spacing: -0.01em;
    }

    .bot-card p {
      margin: 0;
      font-size: 14px;
      color: var(--muted);
      line-height: 1.6;
    }

    .bot-meta {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin: 0;
      padding: 0;
      list-style: none;
    }

    .bot-meta li {
      padding: 6px 12px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.08);
      font-size: 12px;
      color: var(--muted);
    }

    .open-bot-btn {
      margin-top: auto;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 12px 18px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(255, 255, 255, 0.04);
      color: var(--text);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: inherit;
    }

    .open-bot-btn:hover {
      background: rgba(0, 210, 255, 0.15);
      border-color: rgba(0, 210, 255, 0.4);
    }

    .bot-detail-panel {
      flex: 1 1 520px;
      background: var(--panel-soft);
      border-radius: 20px;
      border: 1px solid var(--border);
      padding: 24px;
      min-height: 520px;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .panel-placeholder {
      display: none;
    }

    .bot-detail-panel[hidden] {
      display: none;
    }

    .bot-panel-content {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .bot-panel-content[hidden] {
      display: none !important;
    }

    .bot-panel-header {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .bot-panel-grid {
      display: grid;
      gap: 20px;
      width: 100%;
    }

    .bot-column {
      min-width: 0;
    }

    .bot-history-column {
      display: flex;
      flex-direction: column;
    }

    .history-card {
      background: rgba(15, 17, 23, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 20px;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-height: 560px;
      min-height: 0;
      overflow: hidden;
    }

    .history-card h4 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
    }

    .bot-config,
    .bot-stats {
      background: rgba(15, 17, 23, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .bot-config h4,
    .bot-stats h4 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
    }

    .config-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 16px;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .input-group label {
      font-size: 13px;
      font-weight: 600;
      color: var(--muted);
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    .input-group input {
      width: 100%;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(15, 17, 23, 0.8);
      color: var(--text);
      font-size: 14px;
      font-family: inherit;
    }

    .input-group small {
      color: rgba(152, 162, 189, 0.75);
      font-size: 12px;
      line-height: 1.4;
    }

    .config-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    .primary-btn,
    .secondary-btn {
      padding: 12px 20px;
      border-radius: 10px;
      border: none;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: inherit;
    }

    .primary-btn {
      background: linear-gradient(135deg, rgba(0, 210, 255, 0.35), rgba(0, 210, 255, 0.15));
      border: 1px solid rgba(0, 210, 255, 0.6);
      color: #00d2ff;
    }

    .primary-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .secondary-btn {
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.12);
      color: var(--text);
    }

    .secondary-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    .status-badge[data-state="idle"] {
      background: rgba(255, 255, 255, 0.05);
      color: var(--muted);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .status-badge[data-state="running"] {
      background: rgba(36, 217, 112, 0.1);
      color: var(--success);
      border: 1px solid rgba(36, 217, 112, 0.3);
    }

    .status-badge[data-state="error"] {
      background: rgba(255, 68, 79, 0.12);
      color: var(--danger);
      border: 1px solid rgba(255, 68, 79, 0.3);
    }

    .status-text {
      font-size: 13px;
      color: var(--muted);
    }

    .stats-grid {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .stat-card {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .stat-card:last-child {
      border-bottom: none;
    }

    .stat-label {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: rgba(152, 162, 189, 0.7);
      font-weight: 500;
      font-family: 'Inter', system-ui, sans-serif;
    }

    .stat-value {
      font-size: 15px;
      font-weight: 700;
      letter-spacing: -0.01em;
      font-family: 'Inter', system-ui, sans-serif;
    }

    .stat-value.positive {
      color: #24d970;
    }

    .stat-value.negative {
      color: #ff5f6d;
    }

    /* Colorful data display for different stat types */
    #balanceValue {
      color: #00d2ff;
    }

    #totalProfitValue.positive {
      color: #24d970;
    }

    #totalProfitValue.negative {
      color: #ff5f6d;
    }

    #totalTradesValue {
      color: #ff7a18;
    }

    #winRateValue {
      color: #a855f7;
    }

    #currentStakeValue {
      color: #00d2ff;
    }

    #consecutiveLossesValue {
      color: #ff5f6d;
    }

    #targetValue {
      color: #fcd34d;
    }

    #runningTimeValue {
      color: #00d2ff;
    }

    .history-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      flex: 1;
      min-height: 0;
      overflow-y: auto;
      padding-right: 6px;
      scroll-behavior: smooth;
    }

    .history-list::-webkit-scrollbar {
      width: 6px;
    }

    .history-list::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 3px;
    }

    .history-list::-webkit-scrollbar-thumb {
      background: rgba(0, 210, 255, 0.3);
      border-radius: 3px;
    }

    .history-list::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 210, 255, 0.5);
    }

    .history-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 12px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(255, 255, 255, 0.05);
      font-size: 13px;
    }

    .history-item.win {
      border-color: rgba(36, 217, 112, 0.3);
    }

    .history-item.loss {
      border-color: rgba(255, 68, 79, 0.3);
    }

    .history-meta {
      display: flex;
      flex-direction: column;
      gap: 4px;
      color: var(--muted);
    }

    .history-profit {
      font-weight: 600;
    }

    .history-profit.win {
      color: var(--success);
    }

    .history-profit.loss {
      color: var(--danger);
    }

    footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 16px 24px;
      background: rgba(15, 17, 23, 0.95);
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(255, 255, 255, 0.08);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10;
    }

    .footer-content {
      display: flex;
      align-items: center;
      gap: 24px;
      flex-wrap: wrap;
      justify-content: center;
      width: 100%;
      max-width: 1400px;
      margin: 0 auto;
    }

    .footer-text {
      font-size: 13px;
      color: rgba(152, 162, 189, 0.8);
      font-family: 'Inter', system-ui, sans-serif;
    }

    .powered-by {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: rgba(152, 162, 189, 0.8);
      font-family: 'Inter', system-ui, sans-serif;
    }

    .powered-by span:last-child {
      font-size: 15px;
      font-weight: 700;
      color: #ff444f;
      text-transform: lowercase;
      letter-spacing: 0.06em;
    }

    @media (min-width: 1024px) {
      .bot-panel-grid {
        grid-template-columns: 1.05fr 0.9fr 1fr;
        align-items: start;
      }

      .bot-stats {
        height: 100%;
      }

      .bot-history-column {
        height: 100%;
        display: flex;
        flex-direction: column;
      }

      .history-card {
        height: 100%;
        max-height: 100%;
        display: flex;
        flex-direction: column;
        min-height: 0;
      }

      .history-list {
        max-height: 380px;
        overflow-y: auto;
      }
    }

    @media (max-width: 1023px) {
      .bots-layout {
        flex-direction: column;
      }

      .bots-list {
        max-width: none;
        width: 100%;
      }

      .bot-panel-grid {
        grid-template-columns: 1fr;
      }

      .bot-history-column {
        width: 100%;
      }

      .history-card {
        max-height: none;
        min-height: 400px;
        display: flex;
        flex-direction: column;
      }

      .history-list {
        flex: 1;
        min-height: 0;
        overflow-y: auto;
        padding-bottom: 20px;
        margin-bottom: -20px;
      }
    }

    @media (max-width: 768px) {
      .page {
        padding: 20px 16px;
        padding-bottom: 90px;
      }

      .header {
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        flex-wrap: wrap;
      }

      .header h1 {
        font-size: 14px;
      }

      .back-btn {
        padding: 8px 12px;
        font-size: 13px;
      }

      .back-btn .full-text {
        display: none !important;
      }

      .back-btn .short-text {
        display: inline !important;
      }

      .section-heading {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .deriv-balance-display {
        align-self: flex-start;
        padding: 5px 10px;
      }

      .deriv-balance-label {
        font-size: 10px;
      }

      .deriv-balance-value {
        font-size: 12px;
      }

      .deriv-balance-currency {
        font-size: 10px;
      }

      .header-active {
        gap: 6px;
        flex: 1;
        min-width: 0;
      }

      .header-active button {
        padding: 5px 8px;
        font-size: 10px;
        white-space: nowrap;
      }

      .header-active span {
        font-size: 10px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 120px;
      }

      .header-mt5-btn {
        flex-shrink: 0;
      }

      .bot-detail-panel {
        padding: 18px;
        padding-bottom: 40px;
        overflow-y: auto;
        max-height: calc(100vh - 200px);
      }

      .bot-panel-content {
        padding-bottom: 20px;
      }

      .config-grid {
        grid-template-columns: 1fr;
      }

      .config-actions {
        flex-direction: column;
        align-items: stretch;
      }

      .primary-btn,
      .secondary-btn {
        width: 100%;
        justify-content: center;
      }

      footer {
        padding: 14px 16px;
      }

      .footer-content {
        flex-direction: column;
        gap: 10px;
        text-align: center;
      }

      .footer-text,
      .powered-by {
        font-size: 12px;
      }
    }

    /* Deposit Popup Modal */
    .deposit-popup-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.75);
      backdrop-filter: blur(4px);
      z-index: 1000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn 0.2s ease;
    }

    .deposit-popup-overlay.show {
      display: flex;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    .deposit-popup {
      background: var(--panel);
      border-radius: 20px;
      padding: 28px;
      max-width: 420px;
      width: 100%;
      border: 1px solid var(--border);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      position: relative;
      animation: slideUp 0.3s ease;
      z-index: 1001;
    }

    @keyframes slideUp {
      from {
        transform: translateY(20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .deposit-popup-header {
      margin-bottom: 16px;
    }

    .deposit-popup-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--text);
      margin: 0 0 8px;
      letter-spacing: -0.01em;
    }

    .deposit-popup-message {
      font-size: 14px;
      color: var(--muted);
      line-height: 1.6;
      margin: 0;
    }

    .deposit-popup-actions {
      display: flex;
      gap: 12px;
      margin-top: 24px;
      flex-wrap: wrap;
    }

    .deposit-popup-btn {
      flex: 1;
      min-width: 120px;
      padding: 12px 20px;
      border-radius: 10px;
      border: none;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: inherit;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    .deposit-popup-btn-primary {
      background: linear-gradient(135deg, rgba(36, 217, 112, 0.2) 0%, rgba(36, 217, 112, 0.1) 100%);
      border: 1px solid rgba(36, 217, 112, 0.4);
      color: #24d970;
    }

    .deposit-popup-btn-primary:hover {
      background: linear-gradient(135deg, rgba(36, 217, 112, 0.3) 0%, rgba(36, 217, 112, 0.15) 100%);
      border-color: rgba(36, 217, 112, 0.6);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(36, 217, 112, 0.2);
    }

    .deposit-popup-btn-secondary {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.15);
      color: var(--text);
    }

    .deposit-popup-btn-secondary:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: rgba(255, 255, 255, 0.25);
    }

    @media (max-width: 480px) {
      .deposit-popup {
        padding: 20px;
        border-radius: 16px;
        margin: 16px;
      }

      .deposit-popup-title {
        font-size: 18px;
      }

      .deposit-popup-message {
        font-size: 13px;
      }

      .deposit-popup-actions {
        flex-direction: column;
        gap: 10px;
      }

      .deposit-popup-btn {
        width: 100%;
        min-width: auto;
      }
    }

    @media (max-width: 480px) {
      .page {
        padding-bottom: 85px;
      }

      .header {
        gap: 6px;
      }

      .back-btn {
        padding: 6px 10px;
        font-size: 12px;
        min-width: auto;
      }

      .back-btn .full-text {
        display: none !important;
      }

      .back-btn .short-text {
        display: inline !important;
      }

      .section-heading h2 {
        font-size: 15px;
      }

      .section-heading p {
        font-size: 12px;
      }

      .deriv-balance-display {
        padding: 4px 8px;
        gap: 6px;
      }

      .deriv-balance-label {
        font-size: 9px;
      }

      .deriv-balance-value {
        font-size: 11px;
      }

      .deriv-balance-currency {
        font-size: 9px;
      }

      .header-active {
        gap: 4px;
      }

      .header-active button {
        padding: 4px 6px;
        font-size: 9px;
      }

      .header-active span {
        font-size: 9px;
        max-width: 100px;
      }

      .bot-detail-panel {
        padding-bottom: 50px;
        max-height: calc(100vh - 180px);
      }

      .history-card {
        min-height: 350px;
      }

      .history-list {
        padding-bottom: 30px;
      }

      footer {
        padding: 12px 16px;
      }

      .footer-content {
        gap: 8px;
      }

      .footer-text,
      .powered-by {
        font-size: 11px;
      }
    }
  </style>
</head>
<body>
  <div class="grid-bg"></div>
  <main class="page">
    <div class="header" id="pageHeader">
      <div class="header-default" id="headerDefault">
        <h1>Automated Trading Bots</h1>
        <a href="index.html" class="back-btn">
          <span class="full-text">← Back to Dashboard</span>
          <span class="short-text">← Back</span>
        </a>
      </div>
      <div class="header-active" id="headerActive">
        <button id="headerBackBtn">← Back to bots</button>
        <span id="activeBotName">BOT NAME</span>
      </div>
      <a class="header-mt5-btn" href="mt5trading-bots.html">
        <span class="full-text">Explore MT5 Bots →</span>
        <span class="short-text">MT5 Bots →</span>
      </a>
    </div>

    <div class="section-heading" id="sectionHeading">
      <div class="section-heading-text">
        <h2>Deriv Bots</h2>
        <p>Choose any bot and start automated trading with smart risk management.</p>
      </div>
      <div class="deriv-balance-display" id="derivBalanceDisplay">
        <span class="deriv-balance-label">Balance</span>
        <span class="deriv-balance-value" id="derivBalanceValue">-</span>
        <span class="deriv-balance-currency" id="derivBalanceCurrency"></span>
      </div>
    </div>

    <div class="bots-layout">
      <div class="bots-list" id="botsList">
        <div class="bot-card" id="allMarketsDifferCard">
          <div class="bot-card-content">
            <span class="bot-chip">Digits Differ</span>
            <h3>All Markets Differ</h3>
            <p>Cycles through Volatility 10–100 markets, rotating digits per trade with recovery logic tuned for high-frequency differ contracts.</p>
            <ul class="bot-meta">
              <li>Rating: 4.9/5</li>
              <li>Strategy: Random Markets & Digits</li>
              <li>Recovery: Smart Recovery</li>
            </ul>
            <button class="open-bot-btn" id="openAllMarketsDiffer">Open Bot</button>
          </div>
        </div>

        <div class="bot-card" id="allMarketsOverCard">
          <div class="bot-card-content">
            <span class="bot-chip">Digits Over</span>
            <h3>Random Markets Over 0</h3>
            <p>Fires Digit Over 0 contracts across Volatility 10–100, rotating markets after every trade with the same protective recovery logic.</p>
            <ul class="bot-meta">
              <li>Rating: 4.7/5</li>
              <li>Strategy: Random Markets · Over 0</li>
              <li>Recovery: Smart Recovery</li>
            </ul>
            <button class="open-bot-btn" id="openAllMarketsOver">Open Bot</button>
          </div>
        </div>

        <div class="bot-card" id="allMarketsUnderCard">
          <div class="bot-card-content">
            <span class="bot-chip">Digits Under</span>
            <h3>Random Markets Under 9</h3>
            <p>Targets Digit Under 9 entries on every tick while rotating through Volatility 10–100 markets for better distribution.</p>
            <ul class="bot-meta">
              <li>Rating: 4.8/5</li>
              <li>Strategy: Random Markets · Under 9</li>
              <li>Recovery: Smart Recovery</li>
            </ul>
            <button class="open-bot-btn" id="openAllMarketsUnder">Open Bot</button>
          </div>
        </div>

        <div class="bot-card" id="smartDifferCard">
          <div class="bot-card-content">
            <span class="bot-chip">Digit Differ</span>
            <h3>Smart Differ Pro</h3>
            <p>Advanced digit differ strategy cycling through Volatility 10–100 markets with intelligent digit selection and smart recovery logic.</p>
            <ul class="bot-meta">
              <li>Rating: 4.9/5</li>
              <li>Strategy: Multi-Market Digit Differ</li>
              <li>Recovery: Smart Recovery</li>
            </ul>
            <button class="open-bot-btn" id="openSmartDiffer">Open Bot</button>
          </div>
        </div>

        <div class="bot-card" id="magicRandomBotCard">
          <div class="bot-card-content">
            <span class="bot-chip">Magic Random</span>
            <h3>Magic Random Strategy</h3>
            <p>Randomly selects between Differ, Under 9, and Over 0 trades across all markets with intelligent stop conditions and digit tracking.</p>
            <ul class="bot-meta">
              <li>Rating: 4.9/5</li>
              <li>Strategy: Random Differ/Under/Over · Multi-Market</li>
              <li>Recovery: Smart Recovery with Win-Gated Stops</li>
            </ul>
            <button class="open-bot-btn" id="openMagicRandomBot">Open Bot</button>
          </div>
        </div>

        <div class="bot-card" id="smartVolatilityCard">
          <div class="bot-card-content">
            <span class="bot-chip">Volatility AI</span>
            <h3>Smart Volatility</h3>
            <p>Tracks R75 tick speed, measures ATR in real-time, and flips between CALL and PUT contracts while auto-scaling stake and duration.</p>
            <ul class="bot-meta">
              <li>Rating: 4.95/5</li>
              <li>Strategy: ATR-driven CALL/PUT scalps</li>
              <li>Recovery: Volatility-weighted stake shaping</li>
            </ul>
            <button class="open-bot-btn" id="openSmartVolatility">Open Bot</button>
          </div>
        </div>

        <div class="bot-card" id="smartEvenCard">
          <div class="bot-card-content">
            <span class="bot-chip">Digits Even/Odd</span>
            <h3>Smart Even</h3>
            <p>Scans R50 digit streaks, waits for imbalance confirmation, and attacks DIGITEVEN/DIGITODD entries with adaptive recovery logic.</p>
            <ul class="bot-meta">
              <li>Rating: 4.92/5</li>
              <li>Strategy: Anti-streak even/odd patterning</li>
              <li>Recovery: Pattern-aware martingale</li>
            </ul>
            <button class="open-bot-btn" id="openSmartEven">Open Bot</button>
          </div>
        </div>

        <div class="bot-card" id="noTouchCard">
          <div class="bot-card-content">
            <span class="bot-chip">Range Guard</span>
            <h3>No Touch Sentinel</h3>
            <p>Monitors R100 momentum, RSI, and volatility snapshots to fire NOTOUCH contracts with directional barriers only when range strength spikes.</p>
            <ul class="bot-meta">
              <li>Rating: 4.88/5</li>
              <li>Strategy: Trend-sensing No Touch</li>
              <li>Recovery: 3.1× smart scaling</li>
            </ul>
            <button class="open-bot-btn" id="openNoTouch">Open Bot</button>
          </div>
        </div>

        <div class="bot-card" id="alienRiseFallCard">
          <div class="bot-card-content">
            <span class="bot-chip">Trend Pulse</span>
            <h3>Alien Rise/Fall</h3>
            <p>Tracks R10 waves using fast RSI + EMA filters, waits for confirmed bursts, then fires CALL/PUT contracts with adaptive recovery.</p>
            <ul class="bot-meta">
              <li>Rating: 4.94/5</li>
              <li>Strategy: Rapid trend re-entry</li>
              <li>Recovery: 3.1× adaptive martingale</li>
            </ul>
            <button class="open-bot-btn" id="openAlienRiseFall">Open Bot</button>
          </div>
        </div>

        <div class="bot-card" id="riseFallCard">
          <div class="bot-card-content">
            <span class="bot-chip">Momentum</span>
            <h3>Rise/Fall Pro</h3>
            <p>Blends RSI, MACD, and multi-frame momentum to time R10 CALL/PUT entries with volume-weighted confirmation.</p>
            <ul class="bot-meta">
              <li>Rating: 4.9/5</li>
              <li>Strategy: Momentum-confirmed Rise/Fall</li>
              <li>Recovery: 3.1× adaptive martingale</li>
            </ul>
            <button class="open-bot-btn" id="openRiseFall">Open Bot</button>
          </div>
        </div>
      </div>

      <div class="bot-detail-panel" id="botDetailPanel" hidden>
        <div class="panel-placeholder" id="panelPlaceholder"></div>

        <div class="bot-panel-content" id="botPanelContent" hidden>
          <div class="bot-panel-header">
            <div class="status-badge" id="botStatusBadge" data-state="idle">Idle</div>
            <div class="status-text" id="botStatusText">Waiting for bot configuration.</div>
          </div>

          <div class="bot-panel-grid">
            <div class="bot-column" id="botConfigColumn">
              <div class="bot-config" id="botConfig">
                <h4>Configuration</h4>
                <div class="config-grid">
                  <div class="input-group">
                    <label for="stakeInput">Initial Stake (USD)</label>
                    <input type="number" id="stakeInput" min="0.35" step="0.01" value="1">
                    <small>Default $1. Minimum $0.35. Adjust to match your balance and risk tolerance.</small>
                  </div>
                  <div class="input-group">
                    <label for="takeProfitInput">Take Profit (USD)</label>
                    <input type="number" id="takeProfitInput" min="5" step="1" value="100">
                    <small>Bot stops automatically once this profit target is reached.</small>
                  </div>
                  <div class="input-group">
                    <label for="stopLossInput">Stop Loss (USD)</label>
                    <input type="number" id="stopLossInput" min="50" step="1" value="1000">
                    <small>Bot halts immediately if losses reach this amount.</small>
                  </div>
                  <div class="input-group" id="martingaleGroup">
                    <label for="martingaleInput">Martingale Multiplier</label>
                    <input type="number" id="martingaleInput" min="1" step="0.1" value="16">
                    <small>Default ×16 (same as Differ bots in the app). Applies after each loss.</small>
                  </div>
                </div>

                <div class="config-actions">
                  <button class="primary-btn" id="startBotBtn">Start Bot</button>
                  <button class="secondary-btn" id="stopBotBtn" disabled>Stop Bot</button>
                  <div class="status-text" id="accountHint">Connect your Deriv account from the dashboard before running bots.</div>
                </div>
              </div>
            </div>

            <div class="bot-column" id="botStatsColumn">
              <div class="bot-stats" id="botStats">
                <h4>Live Performance</h4>
                <div class="stats-grid">
                  <div class="stat-card">
                    <span class="stat-label">Account Balance</span>
                    <span class="stat-value" id="balanceValue">-</span>
                  </div>
                  <div class="stat-card">
                    <span class="stat-label">Total Profit</span>
                    <span class="stat-value" id="totalProfitValue">$0.00</span>
                  </div>
                  <div class="stat-card">
                    <span class="stat-label">Total Trades</span>
                    <span class="stat-value" id="totalTradesValue">0</span>
                  </div>
                  <div class="stat-card">
                    <span class="stat-label">Win Rate</span>
                    <span class="stat-value" id="winRateValue">0%</span>
                  </div>
                  <div class="stat-card">
                    <span class="stat-label">Current Stake</span>
                    <span class="stat-value" id="currentStakeValue">$0.00</span>
                  </div>
                  <div class="stat-card">
                    <span class="stat-label">Consecutive Losses</span>
                    <span class="stat-value" id="consecutiveLossesValue">0</span>
                  </div>
                  <div class="stat-card">
                    <span class="stat-label">Market / Digit</span>
                    <span class="stat-value" id="targetValue">-</span>
                  </div>
                  <div class="stat-card">
                    <span class="stat-label">Running Time</span>
                    <span class="stat-value" id="runningTimeValue">00:00:00</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="bot-column bot-history-column">
              <div class="history-card">
                <h4>Recent Trades</h4>
                <div class="history-list" id="historyList">
                  <!-- Trades injected here -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Deposit Popup Modal -->
  <div class="deposit-popup-overlay" id="depositPopupOverlay">
    <div class="deposit-popup">
      <div class="deposit-popup-header">
        <h3 class="deposit-popup-title">Low Account Balance</h3>
        <p class="deposit-popup-message">
          Your account needs more funds to run the trading bot effectively. Adding funds will help you maximize your trading opportunities and achieve better results.
        </p>
      </div>
      <div class="deposit-popup-actions">
        <a href="https://p2p.deriv.com/advertiser/426826?advert_id=3182910&t=_30qaRjl291dMjdsyM5hasGNd7ZgqdRLk" target="_blank" rel="noopener" class="deposit-popup-btn deposit-popup-btn-primary" id="depositPopupBtn">
          Deposit Funds
        </a>
        <button class="deposit-popup-btn deposit-popup-btn-secondary" id="depositPopupCancel">
          Maybe Later
        </button>
      </div>
    </div>
  </div>

  <footer>
    <div class="footer-content">
      <div class="footer-text">© 2026 Magic Automation Lab</div>
      <div class="powered-by">
        <span>Powered by</span>
        <span>deriv</span>
      </div>
    </div>
  </footer>

  <script src="popup-notifications.js"></script>
  <script src="bots/allMarketsDiffer.js"></script>
  <script src="bots/allMarketsOver.js"></script>
  <script src="bots/allMarketsUnder.js"></script>
  <script src="bots/magicRandomBot.js"></script>
  <script src="bots/smartVolatility.js"></script>
  <script src="bots/smartEven.js"></script>
  <script src="bots/noTouch.js"></script>
  <script src="bots/alienRiseFall.js"></script>
  <script src="bots/riseFall.js"></script>
  <script src="bots/smartDifferBot.js"></script>
  <script>
    const APP_ID = '67709';
    const DERIV_WS_URL = `wss://ws.binaryws.com/websockets/v3?app_id=${APP_ID}`;
    const DERIV_OAUTH_TOKENS_KEY = '@deriv_oauth_tokens';
    const DERIV_API_KEY_KEY = '@deriv_api_key';
    const VOLATILITY_MARKETS = ['R_10', 'R_25', 'R_50', 'R_75', 'R_100'];
    const BOT_DEFAULTS = {
      initialStake: 1,
      minStake: 0.35,
      takeProfit: 100,
      stopLoss: 1000,
      martingaleMultiplier: 16
    };
    const DEPOSIT_POPUP_DISMISSED_KEY = '@deposit_popup_dismissed';
    const DEPOSIT_POPUP_DISMISSED_TIMEOUT = 2 * 60 * 60 * 1000; // 2 hours

    // Deriv Balance Display
    const derivBalanceValue = document.getElementById('derivBalanceValue');
    const derivBalanceCurrency = document.getElementById('derivBalanceCurrency');
    const derivBalanceDisplay = document.getElementById('derivBalanceDisplay');

    function updateDerivBalanceDisplay() {
      const token = resolveAuthToken();
      if (!token) {
        derivBalanceValue.textContent = 'Not Connected';
        derivBalanceCurrency.textContent = '';
        derivBalanceDisplay.classList.add('disconnected');
        return;
      }

      const ws = new WebSocket(DERIV_WS_URL);
      let authorized = false;

      ws.onopen = () => {
        ws.send(JSON.stringify({
          authorize: token,
          req_id: Date.now()
        }));
      };

      ws.onmessage = (msg) => {
        try {
          const response = JSON.parse(msg.data);

          if (response.error) {
            console.error('Balance fetch error:', response.error);
            derivBalanceValue.textContent = 'Error';
            derivBalanceCurrency.textContent = '';
            derivBalanceDisplay.classList.add('disconnected');
            ws.close();
            return;
          }

          if (response.msg_type === 'authorize' && response.authorize) {
            authorized = true;
            const balance = Number(response.authorize.balance || 0);
            const currency = response.authorize.currency || 'USD';
            
            derivBalanceValue.textContent = balance.toFixed(2);
            derivBalanceCurrency.textContent = currency;
            derivBalanceDisplay.classList.remove('disconnected');
            ws.close();
          }
        } catch (error) {
          console.error('Error processing balance:', error);
          derivBalanceValue.textContent = 'Error';
          derivBalanceCurrency.textContent = '';
          derivBalanceDisplay.classList.add('disconnected');
          ws.close();
        }
      };

      ws.onerror = () => {
        derivBalanceValue.textContent = 'Error';
        derivBalanceCurrency.textContent = '';
        derivBalanceDisplay.classList.add('disconnected');
      };

      ws.onclose = () => {
        // Connection closed
      };

      // Timeout after 5 seconds
      setTimeout(() => {
        if (ws.readyState === WebSocket.OPEN || ws.readyState === WebSocket.CONNECTING) {
          ws.close();
          if (!authorized) {
            derivBalanceValue.textContent = 'Timeout';
            derivBalanceCurrency.textContent = '';
            derivBalanceDisplay.classList.add('disconnected');
          }
        }
      }, 5000);
    }

    const botsList = document.getElementById('botsList');
    const panelPlaceholder = document.getElementById('panelPlaceholder');
    const botDetailPanel = document.getElementById('botDetailPanel');
    const botPanelContent = document.getElementById('botPanelContent');
    const pageHeader = document.getElementById('pageHeader');
    const headerBackBtn = document.getElementById('headerBackBtn');
    const activeBotName = document.getElementById('activeBotName');
    const sectionHeading = document.getElementById('sectionHeading');
    const martingaleGroup = document.getElementById('martingaleGroup');

    let martingaleInputEl = null;
    let currentMartingaleDefault = BOT_DEFAULTS.martingaleMultiplier;

    let botUI = null;
    let currentBotInstance = null;
    let currentBotKey = null;
    const botInstances = {};
    let lastKnownBalance = null;
    let lastKnownCurrency = 'USD';
    let martingaleEnabled = true;

    activeBotName.textContent = 'Select a bot';

    function openBotPanelUI() {
      botDetailPanel.hidden = false;
      botPanelContent.hidden = false;
      botsList?.classList.add('hidden');
      pageHeader.classList.add('show-active');
      sectionHeading.hidden = true;
      sectionHeading.classList.add('hidden');
    }

    function closeBotPanel(stopBot = true) {
      if (stopBot && currentBotInstance?.isRunning) {
        currentBotInstance.stop('Bot hidden. Restart when ready.', 'warning');
      }
      currentBotInstance = null;
      currentBotKey = null;
      document.querySelectorAll('.bot-card').forEach(card => card.classList.remove('active'));
      pageHeader.classList.remove('show-active');
      botDetailPanel.hidden = true;
      botPanelContent.hidden = true;
      botsList?.classList.remove('hidden');
      sectionHeading.hidden = false;
      sectionHeading.classList.remove('hidden');
      botUI?.showStatus('Waiting for bot configuration.');
    }

    headerBackBtn.addEventListener('click', () => closeBotPanel());

    function resolveAuthToken() {
      try {
        const stored = localStorage.getItem(DERIV_OAUTH_TOKENS_KEY);
        if (stored) {
          const tokens = JSON.parse(stored);
          if (tokens?.selectedAccount?.token) {
            return tokens.selectedAccount.token;
          }
          if (Array.isArray(tokens?.accounts) && tokens.accounts.length) {
            return tokens.accounts[0].token;
          }
        }
      } catch (error) {
        console.error('Failed to read OAuth tokens', error);
      }

      try {
        const apiKey = localStorage.getItem(DERIV_API_KEY_KEY);
        if (apiKey) {
          return apiKey;
        }
      } catch (error) {
        console.error('Failed to read API key', error);
      }

      return null;
    }

    // Initialize balance display
    if (derivBalanceValue && derivBalanceCurrency && derivBalanceDisplay) {
      // Wait for DOM to be ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
          updateDerivBalanceDisplay();
          setInterval(updateDerivBalanceDisplay, 30000);
        });
      } else {
        updateDerivBalanceDisplay();
        setInterval(updateDerivBalanceDisplay, 30000);
      }
    }

    function initBotUI() {
      const startBtn = document.getElementById('startBotBtn');
      const stopBtn = document.getElementById('stopBotBtn');
      const statusBadge = document.getElementById('botStatusBadge');
      const statusText = document.getElementById('botStatusText');
      const balanceValue = document.getElementById('balanceValue');
      const totalProfitValue = document.getElementById('totalProfitValue');
      const totalTradesValue = document.getElementById('totalTradesValue');
      const winRateValue = document.getElementById('winRateValue');
      const currentStakeValue = document.getElementById('currentStakeValue');
      const consecutiveLossesValue = document.getElementById('consecutiveLossesValue');
      const targetValue = document.getElementById('targetValue');
      const runningTimeValue = document.getElementById('runningTimeValue');
      const historyList = document.getElementById('historyList');

      const stakeInput = document.getElementById('stakeInput');
      const takeProfitInput = document.getElementById('takeProfitInput');
      const stopLossInput = document.getElementById('stopLossInput');
      const martingaleInput = document.getElementById('martingaleInput');
      martingaleInputEl = martingaleInput;

      const historyLimit = 20;

      return {
        getConfigValues() {
          const martingaleValue = martingaleEnabled
            ? parseFloat(martingaleInput.value) || BOT_DEFAULTS.martingaleMultiplier
            : 1;
          return {
            initialStake: parseFloat(stakeInput.value) || BOT_DEFAULTS.initialStake,
            takeProfit: parseFloat(takeProfitInput.value) || BOT_DEFAULTS.takeProfit,
            stopLoss: parseFloat(stopLossInput.value) || BOT_DEFAULTS.stopLoss,
            martingaleMultiplier: martingaleValue
          };
        },
        validateConfig(config) {
          if (config.initialStake < BOT_DEFAULTS.minStake) {
            return { valid: false, message: `Minimum stake is $${BOT_DEFAULTS.minStake.toFixed(2)}.` };
          }
          if (config.takeProfit <= 0) {
            return { valid: false, message: 'Take profit must be greater than 0.' };
          }
          if (config.stopLoss <= 0) {
            return { valid: false, message: 'Stop loss must be greater than 0.' };
          }
          if (martingaleEnabled && config.martingaleMultiplier < 1) {
            return { valid: false, message: 'Martingale multiplier must be at least 1.' };
          }
          return { valid: true };
        },
        setRunningState(isRunning) {
          startBtn.disabled = isRunning;
          stopBtn.disabled = !isRunning;
          statusBadge.dataset.state = isRunning ? 'running' : 'idle';
          statusBadge.textContent = isRunning ? 'Running' : 'Idle';
        },
        showStatus(message, type = 'info') {
          statusText.textContent = message;
          if (type === 'error') {
            statusBadge.dataset.state = 'error';
            statusBadge.textContent = 'Error';
            // Check for insufficient balance error
            if (message && message.toLowerCase().includes('insufficient')) {
              showDepositPopup();
            }
          } else if (type === 'success') {
            statusBadge.dataset.state = 'running';
            statusBadge.textContent = 'Running';
          } else if (type === 'warning') {
            statusBadge.dataset.state = 'idle';
            statusBadge.textContent = 'Attention';
          } else if (!startBtn.disabled) {
            statusBadge.dataset.state = 'idle';
            statusBadge.textContent = 'Idle';
          }
        },
        updateBalance(value, currency = 'USD') {
          lastKnownBalance = value;
          lastKnownCurrency = currency;
          balanceValue.textContent = `${currency} ${Number(value).toFixed(2)}`;
        },
        updateStats(stats) {
          totalProfitValue.textContent = `${stats.totalProfit >= 0 ? '+' : ''}$${stats.totalProfit.toFixed(2)}`;
          totalProfitValue.classList.toggle('positive', stats.totalProfit > 0);
          totalProfitValue.classList.toggle('negative', stats.totalProfit < 0);
          totalTradesValue.textContent = stats.totalTrades;
          winRateValue.textContent = `${stats.winRate}%`;
          currentStakeValue.textContent = `$${Number(stats.currentStake).toFixed(2)}`;
          consecutiveLossesValue.textContent = stats.consecutiveLosses;
          targetValue.textContent = `${stats.market} / ${stats.digit}`;
          runningTimeValue.textContent = stats.runningTime;
        },
        updateTargets(market, digit) {
          targetValue.textContent = `${market} / ${digit}`;
        },
        updateRunningTime(value) {
          runningTimeValue.textContent = value;
        },
        resetHistory() {
          historyList.innerHTML = '';
        },
        addHistoryEntry(entry) {
          const item = document.createElement('div');
          item.className = `history-item ${entry.win ? 'win' : 'loss'}`;

          const meta = document.createElement('div');
          meta.className = 'history-meta';
          meta.innerHTML = `
            <strong>${entry.market} · Digit ${entry.digit}</strong>
            <span>${entry.timestamp.toLocaleTimeString()}</span>
            <span>Stake: $${Number(entry.stake).toFixed(2)}</span>
          `;

          const profit = document.createElement('div');
          profit.className = `history-profit ${entry.win ? 'win' : 'loss'}`;
          profit.textContent = `${entry.win ? '+' : ''}$${entry.profit.toFixed(2)}`;

          item.appendChild(meta);
          item.appendChild(profit);

          historyList.prepend(item);
          while (historyList.children.length > historyLimit) {
            historyList.removeChild(historyList.lastChild);
          }
        },
        setMartingaleVisibility(show) {
          if (martingaleGroup) {
            martingaleGroup.style.display = show ? '' : 'none';
          }
        }
      };
    }

    botUI = initBotUI();
    function setMartingaleEnabled(enabled) {
      martingaleEnabled = enabled;
      botUI.setMartingaleVisibility(enabled);
      if (!enabled && martingaleInputEl) {
        martingaleInputEl.value = '1';
      } else if (enabled && martingaleInputEl) {
        martingaleInputEl.value = currentMartingaleDefault;
      }
    }
    setMartingaleEnabled(true);
    const sharedDependencies = () => ({
      wsUrl: DERIV_WS_URL,
      defaults: BOT_DEFAULTS,
      markets: VOLATILITY_MARKETS,
      resolveAuthToken
    });

    const BOT_DEFINITIONS = [
      {
        key: 'allMarketsDiffer',
        name: 'All Markets Differ',
        cardId: 'allMarketsDifferCard',
        buttonId: 'openAllMarketsDiffer',
        createInstance: () => new window.AllMarketsDifferBot(botUI, sharedDependencies())
      },
      {
        key: 'allMarketsOver',
        name: 'Random Markets Over 0',
        cardId: 'allMarketsOverCard',
        buttonId: 'openAllMarketsOver',
        createInstance: () => new window.AllMarketsOverBot(botUI, sharedDependencies())
      },
      {
        key: 'allMarketsUnder',
        name: 'Random Markets Under 9',
        cardId: 'allMarketsUnderCard',
        buttonId: 'openAllMarketsUnder',
        createInstance: () => new window.AllMarketsUnderBot(botUI, sharedDependencies())
      },
      {
        key: 'magicRandomBot',
        name: 'Magic Random Strategy',
        cardId: 'magicRandomBotCard',
        buttonId: 'openMagicRandomBot',
        createInstance: () => new window.MagicRandomBot(botUI, sharedDependencies())
      },
      {
        key: 'smartVolatility',
        name: 'Smart Volatility',
        cardId: 'smartVolatilityCard',
        buttonId: 'openSmartVolatility',
        supportsMartingale: false,
        createInstance: () => new window.SmartVolatilityBot(botUI, sharedDependencies())
      },
      {
        key: 'smartEven',
        name: 'Smart Even',
        cardId: 'smartEvenCard',
        buttonId: 'openSmartEven',
        defaultMartingale: 3.1,
        createInstance: () => new window.SmartEvenBot(botUI, sharedDependencies())
      },
      {
        key: 'noTouch',
        name: 'No Touch Sentinel',
        cardId: 'noTouchCard',
        buttonId: 'openNoTouch',
        defaultMartingale: 16,
        createInstance: () => new window.NoTouchBot(botUI, sharedDependencies())
      },
      {
        key: 'alienRiseFall',
        name: 'Alien Rise/Fall',
        cardId: 'alienRiseFallCard',
        buttonId: 'openAlienRiseFall',
        defaultMartingale: 3.1,
        createInstance: () => new window.AlienRiseFallBot(botUI, sharedDependencies())
      },
      {
        key: 'riseFall',
        name: 'Rise/Fall Pro',
        cardId: 'riseFallCard',
        buttonId: 'openRiseFall',
        defaultMartingale: 3.1,
        createInstance: () => new window.RiseFallBot(botUI, sharedDependencies())
      },
      {
        key: 'smartDiffer',
        name: 'Smart Differ Pro',
        cardId: 'smartDifferCard',
        buttonId: 'openSmartDiffer',
        defaultMartingale: 16,
        createInstance: () => new window.SmartDifferBot(botUI, sharedDependencies())
      }
    ];

    const BOT_DEFINITION_MAP = BOT_DEFINITIONS.reduce((acc, def) => {
      acc[def.key] = def;
      return acc;
    }, {});

    function getBotInstance(key) {
      if (!botInstances[key]) {
        const def = BOT_DEFINITION_MAP[key];
        if (!def) return null;
        botInstances[key] = def.createInstance();
      }
      return botInstances[key];
    }

    function setActiveCard(key) {
      document.querySelectorAll('.bot-card').forEach(card => card.classList.remove('active'));
      if (key && BOT_DEFINITION_MAP[key]) {
        document.getElementById(BOT_DEFINITION_MAP[key].cardId)?.classList.add('active');
      }
    }

    function handleBotOpen(key) {
      const def = BOT_DEFINITION_MAP[key];
      if (!def) return;

      if (currentBotKey && currentBotKey !== key && currentBotInstance?.isRunning) {
        currentBotInstance.stop('Switched bots. Previous session stopped.', 'warning');
      }

      currentBotKey = key;
      currentBotInstance = getBotInstance(key);
      activeBotName.textContent = def.name;
      currentMartingaleDefault = def.defaultMartingale ?? BOT_DEFAULTS.martingaleMultiplier;
      setMartingaleEnabled(def.supportsMartingale !== false);
      if (martingaleInputEl && def.supportsMartingale !== false) {
        martingaleInputEl.value = currentMartingaleDefault;
      }
      setActiveCard(key);
      openBotPanelUI();
      // Scroll to top on small screens, center on large screens
      const isSmallScreen = window.innerWidth <= 768;
      if (isSmallScreen) {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      } else {
        botPanelContent.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
      if (lastKnownBalance !== null) {
        botUI.updateBalance(lastKnownBalance, lastKnownCurrency);
        // Check if balance is 1 USD or lower
        if (lastKnownBalance <= 1) {
          showDepositPopup();
        }
      }
    }

    BOT_DEFINITIONS.forEach((def) => {
      const card = document.getElementById(def.cardId);
      const button = document.getElementById(def.buttonId);
      card?.addEventListener('click', () => handleBotOpen(def.key));
      button?.addEventListener('click', (event) => {
        event.stopPropagation();
        handleBotOpen(def.key);
      });
    });

    document.getElementById('startBotBtn').addEventListener('click', () => {
      if (!currentBotInstance) {
        botUI.showStatus('Select a bot first to configure and start.', 'warning');
        return;
      }
      const config = botUI.getConfigValues();
      const validation = botUI.validateConfig(config);
      if (!validation.valid) {
        botUI.showStatus(validation.message, 'error');
        return;
      }
      currentBotInstance.start(config);
    });

    document.getElementById('stopBotBtn').addEventListener('click', () => {
      if (currentBotInstance) {
        currentBotInstance.stop('Bot stopped by user.', 'warning');
      }
    });
  </script>
</body>
</html>

