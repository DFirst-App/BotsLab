<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MT5 Trading Bots - DFirst Automation Lab</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      color-scheme: dark;
      --bg: #02040a;
      --accent: #6ef3b4;
      --accent-2: #00d2ff;
      --text: #f5f7ff;
      --muted: #9ca8c6;
      --panel: rgba(6, 9, 18, 0.9);
      --border: rgba(255, 255, 255, 0.08);
      --success: #24d970;
      --danger: #ff5f6d;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      min-height: 100vh;
      background: radial-gradient(circle at 20% 20%, rgba(0, 210, 255, 0.25), transparent 45%), var(--bg);
      color: var(--text);
      overflow-x: hidden;
    }

    .grid-bg {
      position: fixed;
      inset: 0;
      pointer-events: none;
      background-image:
        linear-gradient(rgba(0, 210, 255, 0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(110, 243, 180, 0.04) 1px, transparent 1px);
      background-size: 120px 120px;
      opacity: 0.4;
      z-index: 0;
    }

    .page-container {
      position: relative;
      z-index: 1;
      width: 100%;
      min-height: 100vh;
      display: flex;
      gap: 24px;
      padding: 24px;
      max-width: 1920px;
      margin: 0 auto;
    }

    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 24px;
      min-width: 0;
    }

    .back-link {
      align-self: flex-start;
      padding: 8px 16px;
      border-radius: 999px;
      border: 1px solid rgba(0, 210, 255, 0.35);
      text-decoration: none;
      color: var(--text);
      font-weight: 600;
      transition: all 0.2s ease;
      font-size: 14px;
    }

    .back-link:hover {
      border-color: rgba(110, 243, 180, 0.6);
      box-shadow: 0 6px 20px rgba(0, 210, 255, 0.25);
    }

    .mt5-accounts-header {
      width: 100%;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 12px;
      box-shadow: 0 8px 24px rgba(4, 6, 12, 0.4);
      margin-bottom: 16px;
    }

    .mt5-accounts-container {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: flex-start;
    }

    .mt5-account-card {
      background: linear-gradient(135deg, rgba(0, 210, 255, 0.08), rgba(0, 210, 255, 0.04));
      border: 1px solid rgba(0, 210, 255, 0.2);
      border-radius: 10px;
      padding: 10px 12px;
      min-width: 180px;
      flex: 1 1 auto;
      display: flex;
      flex-direction: column;
      gap: 6px;
      transition: all 0.2s ease;
    }

    .mt5-account-card:hover {
      background: linear-gradient(135deg, rgba(0, 210, 255, 0.12), rgba(0, 210, 255, 0.06));
      border-color: rgba(0, 210, 255, 0.35);
      transform: translateY(-1px);
    }

    .mt5-account-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .mt5-account-label {
      font-size: 9px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 600;
      font-family: 'Inter', 'Courier New', monospace;
    }

    .mt5-account-value {
      font-size: 10px;
      font-weight: 600;
      color: var(--accent-2);
      font-family: 'Inter', 'Courier New', monospace;
      text-align: right;
      font-variant-numeric: tabular-nums;
    }

    .mt5-account-value.balance {
      color: var(--success);
      font-size: 11px;
      font-weight: 700;
    }

    .mt5-account-value.account-number {
      color: var(--text);
      font-size: 9px;
      font-weight: 500;
    }

    .mt5-create-account-container {
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px solid rgba(255, 255, 255, 0.08);
    }

    .mt5-create-btn-small {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 6px 12px;
      background: linear-gradient(135deg, rgba(0, 210, 255, 0.15), rgba(0, 210, 255, 0.08));
      border: 1px solid rgba(0, 210, 255, 0.3);
      border-radius: 8px;
      color: var(--accent-2);
      text-decoration: none;
      font-weight: 600;
      font-size: 10px;
      font-family: 'Inter', 'Courier New', monospace;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      transition: all 0.2s ease;
    }

    .mt5-create-btn-small:hover {
      background: linear-gradient(135deg, rgba(0, 210, 255, 0.25), rgba(0, 210, 255, 0.15));
      border-color: rgba(0, 210, 255, 0.5);
      transform: translateY(-1px);
    }

    .market-data-panel {
      width: 400px;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 18px 45px rgba(4, 6, 12, 0.55);
      display: flex;
      flex-direction: column;
      gap: 16px;
      max-height: calc(100vh - 48px);
      position: sticky;
      top: 24px;
    }

    .market-data-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .market-data-header h3 {
      margin: 0;
      font-size: 18px;
      font-weight: 700;
    }

    .connection-status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      font-weight: 600;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--muted);
      animation: pulse 2s infinite;
    }

    .status-dot.connected {
      background: var(--success);
    }

    .status-dot.reconnecting {
      background: #ffa726;
    }

    .status-dot.error {
      background: var(--danger);
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .market-data-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      overflow-y: auto;
      flex: 1;
    }

    .market-data-list::-webkit-scrollbar {
      width: 6px;
    }

    .market-data-list::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 3px;
    }

    .market-data-list::-webkit-scrollbar-thumb {
      background: rgba(0, 210, 255, 0.3);
      border-radius: 3px;
    }

    .market-data-item {
      display: grid;
      grid-template-columns: 1fr auto auto;
      gap: 12px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      transition: all 0.2s ease;
      align-items: center;
    }

    .market-data-item:hover {
      background: rgba(255, 255, 255, 0.06);
      border-color: rgba(0, 210, 255, 0.2);
    }

    .market-symbol {
      font-weight: 600;
      font-size: 12px;
      color: var(--text);
      letter-spacing: 0.02em;
    }

    .market-price {
      font-weight: 600;
      font-size: 12px;
      text-align: right;
      font-variant-numeric: tabular-nums;
    }

    .market-price.positive {
      color: var(--success);
    }

    .market-price.negative {
      color: var(--danger);
    }

    .market-price.neutral {
      color: var(--text);
    }

    .market-change {
      font-size: 11px;
      font-weight: 600;
      text-align: right;
      font-variant-numeric: tabular-nums;
    }

    .market-change.positive {
      color: var(--success);
    }

    .market-change.negative {
      color: var(--danger);
    }

    .see-market-data-btn {
      display: none;
      padding: 12px 24px;
      background: linear-gradient(135deg, rgba(0, 210, 255, 0.2), rgba(0, 210, 255, 0.1));
      border: 1px solid rgba(0, 210, 255, 0.3);
      border-radius: 12px;
      color: var(--accent-2);
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
    }

    .see-market-data-btn:hover {
      background: linear-gradient(135deg, rgba(0, 210, 255, 0.3), rgba(0, 210, 255, 0.2));
      border-color: rgba(0, 210, 255, 0.5);
      transform: translateY(-2px);
    }

    .market-data-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      z-index: 1000;
      padding: 20px;
      overflow-y: auto;
    }

    .market-data-modal.active {
      display: flex;
      flex-direction: column;
    }

    .market-data-modal-content {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 24px;
      max-width: 600px;
      width: 100%;
      margin: auto;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h3 {
      margin: 0;
      font-size: 20px;
      font-weight: 700;
    }

    .close-modal-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      color: var(--text);
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 20px;
      line-height: 1;
    }

    .close-modal-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.3);
    }

    .modal-market-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      overflow-y: auto;
      flex: 1;
    }

    @media (max-width: 1024px) {
      .page-container {
        flex-direction: column;
        padding: 16px;
      }

      .market-data-panel {
        display: none;
      }

      .see-market-data-btn {
        display: block;
      }
    }

    @media (max-width: 768px) {
      .mt5-accounts-header {
        padding: 10px;
        border-radius: 12px;
      }

      .mt5-account-card {
        min-width: 100%;
        padding: 8px 10px;
      }

      .mt5-account-label {
        font-size: 8px;
      }

      .mt5-account-value {
        font-size: 9px;
      }

      .mt5-account-value.balance {
        font-size: 10px;
      }

      .mt5-create-btn-small {
        font-size: 9px;
        padding: 5px 10px;
      }

      .bot-card {
        padding: 20px;
      }

      .bot-card h3 {
        font-size: 18px;
      }

      .bot-card p {
        font-size: 13px;
      }

      .bot-meta {
        gap: 8px;
      }

      .bot-meta li {
        font-size: 11px;
        padding: 5px 10px;
      }

      .open-bot-btn {
        padding: 10px 16px;
        font-size: 13px;
      }

      .signal-bot-status {
        gap: 4px;
      }

      .status-text {
        font-size: 12px;
      }
    }

    @media (max-width: 480px) {
      .mt5-accounts-header {
        padding: 8px;
      }

      .mt5-account-card {
        padding: 6px 8px;
        gap: 4px;
      }

      .mt5-account-row {
        gap: 6px;
      }

      .bot-card {
        padding: 16px;
      }

      .bot-card h3 {
        font-size: 16px;
      }

      .bot-card p {
        font-size: 12px;
      }

      .bot-chip,
      .win-rate-badge {
        font-size: 11px;
        padding: 3px 8px;
      }

      .bot-meta {
        gap: 6px;
      }

      .bot-meta li {
        font-size: 10px;
        padding: 4px 8px;
      }

      .open-bot-btn {
        padding: 10px 14px;
        font-size: 12px;
      }

      .status-badge {
        font-size: 11px;
        padding: 5px 12px;
      }

      .status-text {
        font-size: 11px;
      }

      .bots-grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }

      .signal-bot-section {
        grid-template-columns: 1fr;
      }

      .coming-soon-message {
        padding: 12px;
      }

      .coming-soon-text {
        font-size: 13px;
      }

      .coming-soon-details {
        font-size: 11px;
      }

      .waitlist-btn {
        padding: 8px 12px;
        font-size: 12px;
      }
    }

    /* Bot Card Styles (for signal bot) */
    .bot-card {
      background: var(--panel);
      border-radius: 18px;
      padding: 24px;
      border: 1px solid var(--border);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .bot-card::after {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      border: 1px solid transparent;
      background: linear-gradient(120deg, rgba(0, 210, 255, 0.35), rgba(255, 122, 24, 0.2));
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 0;
    }

    .bot-card:hover::after {
      opacity: 1;
    }

    .bot-card-content {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .bot-chip {
      display: inline-flex;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(0, 210, 255, 0.12);
      border: 1px solid rgba(0, 210, 255, 0.25);
      color: #00d2ff;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    .bot-card h3 {
      margin: 0;
      font-size: 20px;
      font-weight: 700;
      color: var(--text);
      letter-spacing: -0.01em;
    }

    .bot-card p {
      margin: 0;
      font-size: 14px;
      color: var(--muted);
      line-height: 1.6;
    }

    .bot-meta {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin: 0;
      padding: 0;
      list-style: none;
    }

    .bot-meta li {
      padding: 6px 12px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.08);
      font-size: 12px;
      color: var(--muted);
    }

    .open-bot-btn {
      margin-top: auto;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 12px 18px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(255, 255, 255, 0.04);
      color: var(--text);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: inherit;
    }

    .open-bot-btn:hover:not(:disabled) {
      background: rgba(0, 210, 255, 0.15);
      border-color: rgba(0, 210, 255, 0.4);
    }

    .open-bot-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Signal Bot Styles */
    .signal-bot-section {
      margin-top: 24px;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 24px;
      align-items: start;
    }

    .win-rate-badge {
      display: inline-flex;
      padding: 4px 10px;
      border-radius: 999px;
      background: linear-gradient(135deg, rgba(36, 217, 112, 0.15), rgba(36, 217, 112, 0.08));
      border: 1px solid rgba(36, 217, 112, 0.3);
      color: var(--success);
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 0.05em;
    }

    .signal-bot-status {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 8px;
    }

    .download-card {
      opacity: 0.9;
    }

    .download-card h3 {
      font-size: 16px;
      font-weight: 600;
      color: var(--text);
      letter-spacing: -0.01em;
    }

    .download-card p {
      font-size: 11px;
      color: var(--muted);
      line-height: 1.5;
    }

    /* Coming Soon Bots Styles */
    .coming-soon-bots-section {
      margin-top: 32px;
    }

    .bots-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 24px;
    }

    .coming-soon-card {
      opacity: 0.95;
      position: relative;
    }

    .coming-soon-card::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background: linear-gradient(135deg, rgba(255, 122, 24, 0.1), rgba(0, 210, 255, 0.1));
      z-index: 0;
      pointer-events: none;
    }

    .coming-soon-badge {
      display: inline-flex;
      padding: 4px 10px;
      border-radius: 999px;
      background: linear-gradient(135deg, rgba(255, 122, 24, 0.2), rgba(255, 122, 24, 0.1));
      border: 1px solid rgba(255, 122, 24, 0.4);
      color: #ff7a18;
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 0.05em;
      animation: pulse-glow 2s ease-in-out infinite;
    }

    @keyframes pulse-glow {
      0%, 100% {
        box-shadow: 0 0 8px rgba(255, 122, 24, 0.3);
      }
      50% {
        box-shadow: 0 0 16px rgba(255, 122, 24, 0.5);
      }
    }

    .coming-soon-message {
      margin-top: 16px;
      padding: 16px;
      background: rgba(255, 122, 24, 0.08);
      border: 1px solid rgba(255, 122, 24, 0.2);
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .coming-soon-text {
      margin: 0;
      font-size: 14px;
      font-weight: 600;
      color: var(--text);
      text-align: center;
    }

    .coming-soon-details {
      margin: 0;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.6;
      text-align: center;
    }

    .waitlist-buttons {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 4px;
    }

    .waitlist-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 10px 16px;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 600;
      text-decoration: none;
      transition: all 0.2s ease;
      border: 1px solid;
    }

    .whatsapp-btn {
      background: rgba(37, 211, 102, 0.1);
      border-color: rgba(37, 211, 102, 0.3);
      color: #25d366;
    }

    .whatsapp-btn:hover {
      background: rgba(37, 211, 102, 0.2);
      border-color: rgba(37, 211, 102, 0.5);
      transform: translateY(-2px);
    }

    .telegram-btn {
      background: rgba(0, 136, 204, 0.1);
      border-color: rgba(0, 136, 204, 0.3);
      color: #0088cc;
    }

    .telegram-btn:hover {
      background: rgba(0, 136, 204, 0.2);
      border-color: rgba(0, 136, 204, 0.5);
      transform: translateY(-2px);
    }

    .status-badge {
      padding: 6px 16px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    .status-badge[data-state="idle"] {
      background: rgba(152, 162, 189, 0.2);
      color: var(--muted);
      border: 1px solid rgba(152, 162, 189, 0.3);
    }

    .status-badge[data-state="running"] {
      background: rgba(36, 217, 112, 0.2);
      color: var(--success);
      border: 1px solid rgba(36, 217, 112, 0.4);
      animation: pulse 2s infinite;
    }

    .status-badge[data-state="error"] {
      background: rgba(255, 95, 109, 0.2);
      color: var(--danger);
      border: 1px solid rgba(255, 95, 109, 0.4);
    }

    .status-text {
      font-size: 13px;
      color: var(--muted);
      text-align: center;
    }

    .signal-history-section {
      margin-top: 32px;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 24px;
      box-shadow: 0 8px 24px rgba(4, 6, 12, 0.4);
    }

    .signal-history-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-height: 400px;
      overflow-y: auto;
    }

    .signal-history-list::-webkit-scrollbar {
      width: 6px;
    }

    .signal-history-list::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 3px;
    }

    .signal-history-list::-webkit-scrollbar-thumb {
      background: rgba(0, 210, 255, 0.3);
      border-radius: 3px;
    }

    .signal-history-item {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      transition: all 0.2s ease;
    }

    .signal-history-item:hover {
      background: rgba(255, 255, 255, 0.06);
      border-color: rgba(0, 210, 255, 0.2);
    }

    .signal-history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .signal-symbol {
      font-weight: 700;
      font-size: 16px;
      color: var(--text);
    }

    .signal-direction {
      padding: 4px 12px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
    }

    .signal-direction.buy {
      background: rgba(36, 217, 112, 0.2);
      color: var(--success);
      border: 1px solid rgba(36, 217, 112, 0.4);
    }

    .signal-direction.sell {
      background: rgba(255, 95, 109, 0.2);
      color: var(--danger);
      border: 1px solid rgba(255, 95, 109, 0.4);
    }

    .signal-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 8px;
      font-size: 12px;
    }

    .signal-detail-item {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .signal-detail-label {
      color: var(--muted);
      font-size: 11px;
      font-weight: 600;
    }

    .signal-detail-value {
      color: var(--text);
      font-weight: 700;
      font-variant-numeric: tabular-nums;
    }

    .signal-confidence {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 8px;
      font-size: 11px;
      font-weight: 700;
      background: rgba(0, 210, 255, 0.2);
      color: var(--accent-2);
      border: 1px solid rgba(0, 210, 255, 0.3);
    }
  </style>
</head>
<body>
  <div class="grid-bg"></div>
  <div class="page-container">
    <div class="main-content">
      <a href="trading-bots.html" class="back-link">‚Üê Back to Web Bots</a>
      
      <!-- MT5 Accounts Header -->
      <div class="mt5-accounts-header" id="mt5AccountsHeader">
        <div class="mt5-accounts-container" id="mt5AccountsContainer">
          <!-- MT5 account cards will be populated here -->
        </div>
        <div class="mt5-create-account-container" id="mt5CreateContainer" style="display: none;">
          <a href="https://app.deriv.com/?t=_30qaRjl291dMjdsyM5hasGNd7ZgqdRLk" target="_blank" rel="noopener" class="mt5-create-btn-small">
            + Create MT5 Account
          </a>
        </div>
      </div>

      <button class="see-market-data-btn" id="seeMarketDataBtn">See Market Data</button>

      <!-- Signal Bot Section -->
      <div class="signal-bot-section">
        <!-- Elite Signal Bot -->
        <div class="bot-card" id="eliteSignalBotCard">
          <div class="bot-card-content">
            <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
              <span class="bot-chip">Signal Analysis</span>
              <span class="win-rate-badge">60% Win Rate</span>
            </div>
            <h3>Elite Signal Bot</h3>
            <p>Advanced multi-market analysis with RSI, MACD, Moving Averages, and Bollinger Bands. Generates high-confidence trading signals with stop loss and three take profit levels.</p>
            <ul class="bot-meta">
              <li>Multi-Indicator Analysis</li>
              <li>3 Take Profit Levels</li>
              <li>Real-time Signals</li>
            </ul>
            <button class="open-bot-btn" id="startEliteSignalBot">Start Signal Analysis</button>
            <div class="signal-bot-status" id="signalBotStatus" style="margin-top: 8px;">
              <span class="status-badge" id="signalStatusBadge" data-state="idle">Idle</span>
              <span class="status-text" id="signalStatusText">Ready to analyze markets</span>
            </div>
          </div>
        </div>

        <!-- Boom & Crash Signal Bot -->
        <div class="bot-card" id="boomCrashBotCard">
          <div class="bot-card-content">
            <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
              <span class="bot-chip">Boom & Crash</span>
              <span class="win-rate-badge">75% Win Rate</span>
            </div>
            <h3>Boom & Crash Signal Bot</h3>
            <p>Specialized signal generator for Boom and Crash indices. Automatically analyzes market patterns and generates high-probability signals with stop loss and take profit levels.</p>
            <ul class="bot-meta">
              <li>Auto-Analysis</li>
              <li>Boom/Crash Focus</li>
              <li>Fast Signals</li>
            </ul>
            <div class="signal-bot-status" id="boomCrashBotStatus" style="margin-top: 8px;">
              <span class="status-badge" id="boomCrashStatusBadge" data-state="idle">Analyzing...</span>
              <span class="status-text" id="boomCrashStatusText">Auto-analyzing Boom & Crash markets</span>
            </div>
          </div>
        </div>

        <!-- Download MT5 Bots Card -->
        <div class="bot-card download-card" id="downloadMT5BotsCard">
          <div class="bot-card-content">
            <h3 style="font-size: 16px; margin-bottom: 8px;">Download MT5 Fully Automated Trading AI Bots</h3>
            <p style="font-size: 11px; color: var(--muted); line-height: 1.5; margin: 0;">
              Expert Advisors (EAs) for MetaTrader 5 platform. Fully automated trading bots ready for direct use in MT5.
            </p>
          </div>
        </div>

        <!-- Signal History -->
        <div class="signal-history-section" id="signalHistorySection" style="display: none; grid-column: 1 / -1; margin-top: 24px;">
          <h3 style="margin: 0 0 16px; font-size: 18px; font-weight: 600;">Signal History</h3>
          <div class="signal-history-list" id="signalHistoryList">
            <!-- Signals will appear here -->
          </div>
        </div>
      </div>

      <!-- Coming Soon Bots Section -->
      <div class="coming-soon-bots-section">
        <div class="bots-grid">
          <div class="bot-card coming-soon-card" id="smartMoneyBotCard">
            <div class="bot-card-content">
              <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
                <span class="bot-chip">Smart Money</span>
                <span class="win-rate-badge">92% Win Rate</span>
                <span class="coming-soon-badge">Coming Soon</span>
              </div>
              <h3>Smart Money Bot</h3>
              <p>Advanced institutional trading strategies that follow smart money movements. Analyzes order blocks, liquidity zones, and market structure to identify high-probability setups with institutional-grade precision.</p>
              <ul class="bot-meta">
                <li>Order Block Analysis</li>
                <li>Liquidity Zones</li>
                <li>Market Structure</li>
              </ul>
              <div class="coming-soon-message">
                <p class="coming-soon-text">üöÄ <strong>Fully Automated Bot Coming Soon!</strong></p>
                <p class="coming-soon-details">This bot is currently undergoing final testing and optimization. Join our waitlist to be notified when it's available for use. You'll receive early access and priority notifications via WhatsApp and Telegram.</p>
                <div class="waitlist-buttons">
                  <a href="https://whatsapp.com/channel/0029Vb6sxFG9xVJWbyIwL110" target="_blank" rel="noopener" class="waitlist-btn whatsapp-btn">
                    üì± Join WhatsApp Waitlist
                  </a>
                  <a href="https://t.me/+hKMwtHTMf_lmYjE0" target="_blank" rel="noopener" class="waitlist-btn telegram-btn">
                    ‚úàÔ∏è Join Telegram Waitlist
                  </a>
                </div>
              </div>
            </div>
          </div>

          <div class="bot-card coming-soon-card" id="ictBotCard">
            <div class="bot-card-content">
              <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
                <span class="bot-chip">ICT Strategy</span>
                <span class="win-rate-badge">84% Win Rate</span>
                <span class="coming-soon-badge">Coming Soon</span>
              </div>
              <h3>ICT Bot</h3>
              <p>Powered by Inner Circle Trader (ICT) methodology. Identifies premium and discount zones, fair value gaps, and optimal trade entries using institutional candle patterns and market maker strategies.</p>
              <ul class="bot-meta">
                <li>Premium/Discount Zones</li>
                <li>Fair Value Gaps</li>
                <li>ICT Concepts</li>
              </ul>
              <div class="coming-soon-message">
                <p class="coming-soon-text">üöÄ <strong>Fully Automated Bot Coming Soon!</strong></p>
                <p class="coming-soon-details">This bot is currently undergoing final testing and optimization. Join our waitlist to be notified when it's available for use. You'll receive early access and priority notifications via WhatsApp and Telegram.</p>
                <div class="waitlist-buttons">
                  <a href="https://whatsapp.com/channel/0029Vb6sxFG9xVJWbyIwL110" target="_blank" rel="noopener" class="waitlist-btn whatsapp-btn">
                    üì± Join WhatsApp Waitlist
                  </a>
                  <a href="https://t.me/+hKMwtHTMf_lmYjE0" target="_blank" rel="noopener" class="waitlist-btn telegram-btn">
                    ‚úàÔ∏è Join Telegram Waitlist
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="market-data-panel" id="marketDataPanel">
      <div class="market-data-header">
        <h3>Live Markets</h3>
        <div class="connection-status">
          <span class="status-dot" id="statusDot"></span>
          <span id="statusText">Connecting...</span>
        </div>
      </div>
      <div class="market-data-list" id="marketDataList">
        <div style="text-align: center; color: var(--muted); padding: 20px;">
          Loading market data...
        </div>
      </div>
    </div>
  </div>

  <div class="market-data-modal" id="marketDataModal">
    <div class="market-data-modal-content">
      <div class="modal-header">
        <h3>Live Market Data</h3>
        <button class="close-modal-btn" id="closeModalBtn">√ó</button>
      </div>
      <div class="connection-status" style="justify-content: flex-start;">
        <span class="status-dot" id="modalStatusDot"></span>
        <span id="modalStatusText">Connecting...</span>
      </div>
      <div class="modal-market-list" id="modalMarketList">
        <div style="text-align: center; color: var(--muted); padding: 20px;">
          Loading market data...
        </div>
      </div>
    </div>
  </div>

  <script src="popup-notifications.js"></script>
  <script src="mt5bots/mt5ApiConnection.js"></script>
  <script src="mt5bots/eliteSignalBot.js"></script>
  <script>
    const APP_ID = '67709';
    const DERIV_WS_URL = `wss://ws.binaryws.com/websockets/v3?app_id=${APP_ID}`;
    const DERIV_OAUTH_TOKENS_KEY = '@deriv_oauth_tokens';
    const DERIV_API_KEY_KEY = '@deriv_api_key';
    const CREATE_MT5_URL = 'https://app.deriv.com/?t=_30qaRjl291dMjdsyM5hasGNd7ZgqdRLk';

    let mt5Connection = null;
    const marketDataMap = new Map();
    let accountInfo = null;

    function resolveAuthToken() {
      try {
        // Try OAuth tokens first
        const oauthTokens = localStorage.getItem(DERIV_OAUTH_TOKENS_KEY);
        if (oauthTokens) {
          const tokens = JSON.parse(oauthTokens);
          if (tokens.selectedAccount && tokens.selectedAccount.token) {
            return tokens.selectedAccount.token;
          }
        }
        
        // Fallback to API key
        const apiKey = localStorage.getItem(DERIV_API_KEY_KEY);
        if (apiKey) {
          return apiKey;
        }
      } catch (error) {
        console.error('Error resolving auth token:', error);
      }
      return null;
    }

    function updateConnectionStatus(status, message) {
      const statusDot = document.getElementById('statusDot');
      const statusText = document.getElementById('statusText');
      const modalStatusDot = document.getElementById('modalStatusDot');
      const modalStatusText = document.getElementById('modalStatusText');

      // Only show "Connected" or "Not Connected" - reconnection happens silently
      if (status === 'connected') {
        statusDot.className = 'status-dot connected';
        statusText.textContent = 'Connected';
        modalStatusDot.className = 'status-dot connected';
        modalStatusText.textContent = 'Connected';
      } else {
        // Any other status (disconnected, reconnecting, error) shows as "Not Connected"
        statusDot.className = 'status-dot';
        statusText.textContent = 'Not Connected';
        modalStatusDot.className = 'status-dot';
        modalStatusText.textContent = 'Not Connected';
      }
    }

    function updateAccountDisplay(info) {
      // This will be called with account info, but we'll handle all accounts separately
      // The actual display is handled by updateMT5AccountsDisplay
    }

    function updateMT5AccountsDisplay(accounts) {
      const container = document.getElementById('mt5AccountsContainer');
      const createContainer = document.getElementById('mt5CreateContainer');
      
      if (!container) return;

      // Filter for real (non-demo) MT5 accounts
      const realAccounts = (accounts || []).filter(acc => {
        return acc && !acc.is_virtual && acc.account_type !== 'demo';
      });

      // Clear container
      container.innerHTML = '';

      if (realAccounts.length === 0) {
        // Show create account button
        createContainer.style.display = 'block';
        return;
      }

      // Hide create button if accounts exist
      createContainer.style.display = 'none';

      // Display all real MT5 accounts
      realAccounts.forEach(account => {
        const accountType = getMT5AccountType(account.server, account.account_type);
        const accountNumber = account.login || '-';
        const balance = Number(account.balance) || 0;
        const currency = account.currency || 'USD';

        const card = document.createElement('div');
        card.className = 'mt5-account-card';
        card.innerHTML = `
          <div class="mt5-account-row">
            <span class="mt5-account-label">Account #</span>
            <span class="mt5-account-value account-number">${accountNumber}</span>
          </div>
          <div class="mt5-account-row">
            <span class="mt5-account-label">Type</span>
            <span class="mt5-account-value">${accountType}</span>
          </div>
          <div class="mt5-account-row">
            <span class="mt5-account-label">Balance</span>
            <span class="mt5-account-value balance">${balance.toFixed(2)} ${currency}</span>
          </div>
        `;
        container.appendChild(card);
      });

      // Cache accounts for instant display on next visit
      try {
        sessionStorage.setItem('mt5_accounts_cache', JSON.stringify(realAccounts));
      } catch (e) {
        // Ignore storage errors
      }
    }

    function getMT5AccountType(server, accountType) {
      if (!server) return 'MT5 Standard';
      const serverLower = server.toLowerCase();
      const accountTypeLower = (accountType || '').toLowerCase();
      
      if (serverLower.includes('gold') || accountTypeLower.includes('gold')) return 'MT5 Gold';
      if (serverLower.includes('financial') || accountTypeLower.includes('financial') || serverLower.includes('real')) return 'MT5 Financial';
      if (serverLower.includes('swap') || accountTypeLower.includes('swap')) return 'MT5 Swap-Free';
      if (serverLower.includes('zero') || accountTypeLower.includes('zero')) return 'MT5 Zero Spread';
      return 'MT5 Standard';
    }

    function restoreCachedAccounts() {
      try {
        const cached = sessionStorage.getItem('mt5_accounts_cache');
        if (cached) {
          const accounts = JSON.parse(cached);
          if (accounts && accounts.length > 0) {
            updateMT5AccountsDisplay(accounts);
          }
        }
      } catch (e) {
        // Ignore cache errors
      }
    }

    let renderTimeout = null;
    function updateMarketData(data) {
      // Update data immediately
      marketDataMap.set(data.symbol, data);
      
      // Debounce rendering to avoid lag (render every 100ms max)
      if (renderTimeout) {
        clearTimeout(renderTimeout);
      }
      
      renderTimeout = setTimeout(() => {
        renderMarketData();
        renderTimeout = null;
      }, 100);
      
      // Cache market data for faster loading on next visit (throttled)
      if (!updateMarketData.cacheTimeout) {
        updateMarketData.cacheTimeout = setTimeout(() => {
          try {
            const dataArray = Array.from(marketDataMap.values());
            sessionStorage.setItem('mt5_market_data_cache', JSON.stringify(dataArray));
          } catch (e) {
            // Ignore storage errors
          }
          updateMarketData.cacheTimeout = null;
        }, 1000); // Cache every 1 second
      }
    }

    function renderMarketData() {
      const marketDataList = document.getElementById('marketDataList');
      const modalMarketList = document.getElementById('modalMarketList');
      
      if (marketDataMap.size === 0) {
        marketDataList.innerHTML = '<div style="text-align: center; color: var(--muted); padding: 20px;">No market data available</div>';
        modalMarketList.innerHTML = '<div style="text-align: center; color: var(--muted); padding: 20px;">No market data available</div>';
        return;
      }

      // Sort by priority: USD pairs, Volatility, Boom/Crash, then others
      const dataArray = Array.from(marketDataMap.values());
      
      const getPriority = (symbol) => {
        if (symbol.startsWith('frxEURUSD') || symbol.startsWith('frxGBPUSD') || symbol.startsWith('frxUSD') || symbol.startsWith('frxXAUUSD')) return 1;
        if (symbol.startsWith('R_') || symbol.startsWith('1HZ')) return 2;
        if (symbol.startsWith('BOOM_') || symbol.startsWith('CRASH_')) return 3;
        if (symbol.startsWith('frx')) return 4;
        return 5;
      };

      const sortedData = dataArray.sort((a, b) => {
        const priorityA = getPriority(a.symbol);
        const priorityB = getPriority(b.symbol);
        if (priorityA !== priorityB) return priorityA - priorityB;
        return (a.displayName || a.symbol).localeCompare(b.displayName || b.symbol);
      });

      const renderItem = (data) => {
        const changeClass = data.changePercent > 0 ? 'positive' : data.changePercent < 0 ? 'negative' : 'neutral';
        const priceClass = data.change > 0 ? 'positive' : data.change < 0 ? 'negative' : 'neutral';
        const changeSign = data.changePercent > 0 ? '+' : '';
        const displayName = data.displayName || data.symbol;
        
        // Format price based on symbol type
        let priceDisplay = data.price.toFixed(5);
        if (data.symbol.includes('XAU') || data.symbol.includes('XAG')) {
          priceDisplay = data.price.toFixed(2);
        } else if (data.symbol.startsWith('R_') || data.symbol.startsWith('1HZ') || data.symbol.includes('BOOM') || data.symbol.includes('CRASH')) {
          priceDisplay = data.price.toFixed(2);
        } else if (data.symbol.includes('USD') && !data.symbol.includes('XAU') && !data.symbol.includes('XAG')) {
          priceDisplay = data.price.toFixed(5);
        }
        
        return `
          <div class="market-data-item">
            <span class="market-symbol">${displayName}</span>
            <span class="market-price ${priceClass}">${priceDisplay}</span>
            <span class="market-change ${changeClass}">${changeSign}${data.changePercent.toFixed(2)}%</span>
          </div>
        `;
      };

      marketDataList.innerHTML = sortedData.map(renderItem).join('');
      modalMarketList.innerHTML = sortedData.map(renderItem).join('');
    }

    function initializeMT5Connection() {
      const token = resolveAuthToken();
      if (!token) {
        updateConnectionStatus('error', 'Not connected to Deriv');
        updateAccountDisplay(null);
        return;
      }

      // Initialize connection immediately
      mt5Connection = new MT5ApiConnection({
        wsUrl: DERIV_WS_URL,
        resolveAuthToken: resolveAuthToken,
        onMarketDataUpdate: updateMarketData,
        onConnectionStatus: updateConnectionStatus,
        onAccountInfo: (info) => {
          if (info && info.mt5Accounts) {
            updateMT5AccountsDisplay(info.mt5Accounts);
          } else {
            updateMT5AccountsDisplay([]);
          }
        }
      });

      // Connect immediately when page loads
      mt5Connection.connect();
      
      // Also try to restore any cached market data if available
      try {
        const cachedData = sessionStorage.getItem('mt5_market_data_cache');
        if (cachedData) {
          const parsed = JSON.parse(cachedData);
          parsed.forEach(data => {
            marketDataMap.set(data.symbol, data);
          });
          if (marketDataMap.size > 0) {
            renderMarketData();
          }
        }
      } catch (e) {
        // Ignore cache errors
      }
    }

    // Modal controls
    document.getElementById('seeMarketDataBtn').addEventListener('click', () => {
      document.getElementById('marketDataModal').classList.add('active');
    });

    document.getElementById('closeModalBtn').addEventListener('click', () => {
      document.getElementById('marketDataModal').classList.remove('active');
    });

    document.getElementById('marketDataModal').addEventListener('click', (e) => {
      if (e.target.id === 'marketDataModal') {
        document.getElementById('marketDataModal').classList.remove('active');
      }
    });

    // Restore cached accounts immediately
    restoreCachedAccounts();

    // Initialize immediately on page load (don't wait for DOMContentLoaded)
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeMT5Connection);
    } else {
      // DOM already loaded, initialize immediately
      initializeMT5Connection();
    }

    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
      if (mt5Connection) {
        mt5Connection.disconnect();
      }
      if (signalBotInstance) {
        signalBotInstance.stop();
      }
    });

    // Signal Bot Integration
    let signalBotInstance = null;
    const signalHistoryList = document.getElementById('signalHistoryList');
    const signalHistorySection = document.getElementById('signalHistorySection');
    const startSignalBotBtn = document.getElementById('startEliteSignalBot');
    const signalStatusBadge = document.getElementById('signalStatusBadge');
    const signalStatusText = document.getElementById('signalStatusText');

    // Initialize Signal Bot UI
    function initSignalBotUI() {
      return {
        showStatus(message, type = 'info') {
          signalStatusText.textContent = message;
          if (type === 'error') {
            signalStatusBadge.dataset.state = 'error';
            signalStatusBadge.textContent = 'Error';
          } else if (type === 'success' || type === 'running') {
            signalStatusBadge.dataset.state = 'running';
            signalStatusBadge.textContent = 'Running';
          } else if (type === 'warning') {
            signalStatusBadge.dataset.state = 'idle';
            signalStatusBadge.textContent = 'Attention';
          } else {
            signalStatusBadge.dataset.state = 'idle';
            signalStatusBadge.textContent = 'Idle';
          }
        },
        setRunningState(isRunning) {
          startSignalBotBtn.disabled = isRunning;
          startSignalBotBtn.textContent = isRunning ? 'Analyzing Markets...' : 'Start Signal Analysis';
        },
        resetHistory() {
          signalHistoryList.innerHTML = '';
          signalHistorySection.style.display = 'none';
        },
        addHistoryEntry(entry) {
          signalHistorySection.style.display = 'block';
          
          const item = document.createElement('div');
          item.className = 'signal-history-item';
          
          const directionClass = entry.direction === 'BUY' ? 'buy' : 'sell';
          const directionIcon = entry.direction === 'BUY' ? 'üìà' : 'üìâ';
          
          // Format prices
          const formatPrice = (price) => {
            if (entry.symbol.includes('XAU') || entry.symbol.includes('XAG')) {
              return price.toFixed(2);
            } else if (entry.symbol.startsWith('R_') || entry.symbol.includes('BOOM') || entry.symbol.includes('CRASH')) {
              return price.toFixed(2);
            }
            return price.toFixed(5);
          };

          item.innerHTML = `
            <div class="signal-history-header">
              <span class="signal-symbol">${entry.symbol || 'N/A'}</span>
              <div style="display: flex; align-items: center; gap: 8px;">
                <span class="signal-confidence">${entry.confidence || 0}% Confidence</span>
                <span class="signal-direction ${directionClass.toLowerCase()}">${directionIcon} ${entry.direction}</span>
              </div>
            </div>
            <div class="signal-details">
              <div class="signal-detail-item">
                <span class="signal-detail-label">Entry</span>
                <span class="signal-detail-value">${formatPrice(entry.entryPrice)}</span>
              </div>
              <div class="signal-detail-item">
                <span class="signal-detail-label">Stop Loss</span>
                <span class="signal-detail-value" style="color: var(--danger);">${formatPrice(entry.stopLoss)}</span>
              </div>
              <div class="signal-detail-item">
                <span class="signal-detail-label">TP1</span>
                <span class="signal-detail-value" style="color: var(--success);">${formatPrice(entry.takeProfit1)}</span>
              </div>
              <div class="signal-detail-item">
                <span class="signal-detail-label">TP2</span>
                <span class="signal-detail-value" style="color: var(--success);">${formatPrice(entry.takeProfit2)}</span>
              </div>
              <div class="signal-detail-item">
                <span class="signal-detail-label">TP3</span>
                <span class="signal-detail-value" style="color: var(--success);">${formatPrice(entry.takeProfit3)}</span>
              </div>
            </div>
            <div style="font-size: 11px; color: var(--muted); margin-top: 4px;">
              ${entry.timestamp ? new Date(entry.timestamp).toLocaleString() : 'Just now'}
            </div>
          `;

          signalHistoryList.insertBefore(item, signalHistoryList.firstChild);
          
          // Keep only last 20 signals
          while (signalHistoryList.children.length > 20) {
            signalHistoryList.removeChild(signalHistoryList.lastChild);
          }
        },
        updateStats() {
          // Signal bot doesn't need stats updates
        }
      };
    }

    const signalBotUI = initSignalBotUI();

    // Start/Stop Signal Bot
    startSignalBotBtn.addEventListener('click', () => {
      if (signalBotInstance && signalBotInstance.isRunning) {
        signalBotInstance.stop('Signal analysis stopped', 'info');
        signalBotInstance = null;
        return;
      }

      if (!mt5Connection || !mt5Connection.isConnected) {
        signalBotUI.showStatus('Please wait for market data connection...', 'warning');
        return;
      }

      // Create bot instance
      signalBotInstance = new window.EliteSignalBot(signalBotUI, {
        wsUrl: DERIV_WS_URL,
        defaults: {},
        resolveAuthToken: resolveAuthToken,
        marketDataConnection: mt5Connection
      });

      signalBotInstance.start({});
    });

    // Boom & Crash Signal Bot - Auto-start
    let boomCrashBotInstance = null;
    const boomCrashStatusBadge = document.getElementById('boomCrashStatusBadge');
    const boomCrashStatusText = document.getElementById('boomCrashStatusText');

    function initBoomCrashBotUI() {
      return {
        showStatus(message, type = 'info') {
          if (boomCrashStatusText) boomCrashStatusText.textContent = message;
          if (boomCrashStatusBadge) {
            if (type === 'error') {
              boomCrashStatusBadge.dataset.state = 'error';
              boomCrashStatusBadge.textContent = 'Error';
            } else if (type === 'success' || type === 'running') {
              boomCrashStatusBadge.dataset.state = 'running';
              boomCrashStatusBadge.textContent = 'Analyzing';
            } else {
              boomCrashStatusBadge.dataset.state = 'idle';
              boomCrashStatusBadge.textContent = 'Analyzing';
            }
          }
        },
        setRunningState(isRunning) {
          // No button to disable
        },
        resetHistory() {
          // History handled separately if needed
        },
        addHistoryEntry(entry) {
          // Add to signal history if needed
          if (signalHistorySection) {
            signalHistorySection.style.display = 'block';
            const item = document.createElement('div');
            item.className = 'signal-history-item';
            
            const directionClass = entry.direction === 'BUY' ? 'buy' : 'sell';
            const directionIcon = entry.direction === 'BUY' ? 'üìà' : 'üìâ';
            
            const formatPrice = (price) => price.toFixed(2);

            item.innerHTML = `
              <div class="signal-history-header">
                <span class="signal-symbol">${entry.symbol || 'N/A'}</span>
                <div style="display: flex; align-items: center; gap: 8px;">
                  <span class="signal-confidence">${entry.confidence || 0}% Confidence</span>
                  <span class="signal-direction ${directionClass.toLowerCase()}">${directionIcon} ${entry.direction}</span>
                </div>
              </div>
              <div class="signal-details">
                <div class="signal-detail-item">
                  <span class="signal-detail-label">Entry</span>
                  <span class="signal-detail-value">${formatPrice(entry.entryPrice)}</span>
                </div>
                <div class="signal-detail-item">
                  <span class="signal-detail-label">Stop Loss</span>
                  <span class="signal-detail-value" style="color: var(--danger);">${formatPrice(entry.stopLoss)}</span>
                </div>
                <div class="signal-detail-item">
                  <span class="signal-detail-label">TP1</span>
                  <span class="signal-detail-value" style="color: var(--success);">${formatPrice(entry.takeProfit1)}</span>
                </div>
                <div class="signal-detail-item">
                  <span class="signal-detail-label">TP2</span>
                  <span class="signal-detail-value" style="color: var(--success);">${formatPrice(entry.takeProfit2)}</span>
                </div>
                <div class="signal-detail-item">
                  <span class="signal-detail-label">TP3</span>
                  <span class="signal-detail-value" style="color: var(--success);">${formatPrice(entry.takeProfit3)}</span>
                </div>
              </div>
              <div style="font-size: 11px; color: var(--muted); margin-top: 4px;">
                ${entry.timestamp ? new Date(entry.timestamp).toLocaleString() : 'Just now'}
              </div>
            `;

            signalHistoryList.insertBefore(item, signalHistoryList.firstChild);
            
            while (signalHistoryList.children.length > 20) {
              signalHistoryList.removeChild(signalHistoryList.lastChild);
            }
          }
        },
        updateStats() {
          // Not needed for signal bot
        }
      };
    }

    const boomCrashBotUI = initBoomCrashBotUI();

    // Auto-start Boom & Crash bot when MT5 connection is ready
    function autoStartBoomCrashBot() {
      if (boomCrashBotInstance && boomCrashBotInstance.isRunning) {
        return;
      }

      if (!mt5Connection || !mt5Connection.isConnected) {
        // Wait for connection
        setTimeout(autoStartBoomCrashBot, 2000);
        return;
      }

      // Create and start bot
      boomCrashBotInstance = new window.BoomCrashSignalBot(boomCrashBotUI, {
        wsUrl: DERIV_WS_URL,
        defaults: {},
        resolveAuthToken: resolveAuthToken,
        marketDataConnection: mt5Connection
      });

      boomCrashBotInstance.start({});
    }

    // Start Boom & Crash bot after MT5 connection is established
    if (mt5Connection && mt5Connection.isConnected) {
      setTimeout(autoStartBoomCrashBot, 3000);
    } else {
      // Wait for connection
      const checkConnection = setInterval(() => {
        if (mt5Connection && mt5Connection.isConnected) {
          clearInterval(checkConnection);
          setTimeout(autoStartBoomCrashBot, 3000);
        }
      }, 1000);
    }

    // Cleanup Boom & Crash bot on page unload
    window.addEventListener('beforeunload', () => {
      if (boomCrashBotInstance) {
        boomCrashBotInstance.stop();
      }
    });
  </script>
</body>
</html>
